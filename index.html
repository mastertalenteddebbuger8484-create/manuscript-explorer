<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manuscript Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* --- LIVE BACKGROUND --- */
        body {
            background-color: #1a1510;
            color: #f0e6d2;
            font-family: 'Georgia', serif;
            overflow-x: hidden;
        }
        .live-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at center, #2c241b 0%, #1a1510 100%);
        }
        /* Particle Animation */
        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(201, 168, 106, 0.3);
            animation: float 20s infinite linear;
        }
        @keyframes float {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
        }

        /* --- NAVBAR --- */
        .navbar { background-color: rgba(20, 15, 10, 0.95); border-bottom: 2px solid #c9a86a; }
        .navbar-brand { font-weight: bold; color: #c9a86a !important; font-size: 1.5rem; }
        .nav-link { color: #f0e6d2 !important; margin-left: 15px; }
        .dropdown-menu { background-color: #2c241b; border: 1px solid #c9a86a; }
        .dropdown-item { color: #f0e6d2; }
        .dropdown-item:hover { background-color: #c9a86a; color: #000; }

        /* --- UI ELEMENTS --- */
        .hero { text-align: center; padding: 80px 20px; }
        .hero h1 { color: #c9a86a; font-size: 3rem; text-shadow: 2px 2px 4px black; }
        
        .search-bar input {
            background: rgba(255,255,255,0.1); border: 2px solid #c9a86a;
            color: white; padding: 15px; border-radius: 30px; width: 100%; max-width: 600px;
        }

        .manuscript-card {
            background: #2c241b; border: 1px solid #4a3b2a; border-radius: 10px;
            overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; position: relative; height: 100%;
        }
        .manuscript-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(201, 168, 106, 0.2); }
        .card-img-top { height: 250px; object-fit: cover; }
        .card-title { color: #c9a86a; font-weight: bold; }
        .card-text {
            display: -webkit-box; -webkit-line-clamp: 7; -webkit-box-orient: vertical;
            overflow: hidden; text-overflow: ellipsis; min-height: 150px;
        }
        
        /* UPDATED VIEW BUTTON */
        .view-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s; text-decoration: none; /* Removed Underline */
        }
        .manuscript-card:hover .view-overlay { opacity: 1; }
        .btn-view {
            background: #c9a86a; color: #1a1510; font-weight: 800; /* Bold */
            padding: 12px 35px; border-radius: 25px; text-decoration: none;
            letter-spacing: 1px;
        }

        /* CHAT STYLES */
        .chat-btn {
            position: fixed; bottom: 30px; right: 30px; background: #c9a86a;
            width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; cursor: pointer; z-index: 1000;
        }
        .chat-sidebar {
            position: fixed; bottom: 100px; right: -400px; width: 350px; height: 500px;
            background: #2c241b; border: 2px solid #c9a86a; border-radius: 15px;
            transition: right 0.3s; z-index: 999; display: flex; flex-direction: column;
        }
        .chat-sidebar.active { right: 30px; }
        .chat-header { background: #c9a86a; color: #1a1510; padding: 10px; font-weight: bold; }
        .chat-body { flex-grow: 1; padding: 10px; overflow-y: auto; color: white; }
        .chat-input-area { padding: 10px; border-top: 1px solid #4a3b2a; }
        .chat-input-area input { width: 100%; padding: 8px; border-radius: 5px; border: none; }
    </style>
</head>
<body>

    <div class="live-bg" id="bgEffect"></div>

    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="https://img.icons8.com/ios-filled/50/c9a86a/book.png" width="30" height="30" class="d-inline-block align-text-top">
                VedaVault
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon" style="background-color: #c9a86a;"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Home</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">All</a></li>
                            <li><a class="dropdown-item" href="#">New</a></li>
                            <li><a class="dropdown-item" href="#">Top</a></li>
                            <li><a class="dropdown-item" href="#">Old</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="/ai">Ask AI</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="ai.html">Help</a></li>
                            <li><a class="dropdown-item" href="ai.html">About</a></li>
                            <li><a class="dropdown-item" href="ai.html">Chat</a></li>
                            <li><a class="dropdown-item" href="ai.html">Info</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="/admin" data-bs-toggle="dropdown">Add Manuscript</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/admin">Login</a></li>
                            <li><a class="dropdown-item" href="/admin">Upload</a></li>
                            <li><a class="dropdown-item" href="/admin">Edit</a></li>
                            <li><a class="dropdown-item" href="/admin">List</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Contact Us</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Email</a></li>
                            <li><a class="dropdown-item" href="#">Map</a></li>
                            <li><a class="dropdown-item" href="#">Tel</a></li>
                            <li><a class="dropdown-item" href="#">Web</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero">
        <h1>Unveil the Wisdom of the Ages</h1>
        <p class="lead" style="color: #f0e6d2;">Explore thousands of rare Indian manuscripts digitized for the modern era.</p>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search by title, era, or genre..." onkeyup="filterManuscripts()">
        </div>
    </div>

    <div class="container mb-5">
        <div class="row row-cols-1 row-cols-md-3 g-4" id="manuscriptGrid">
            {% for m in manuscripts %}
            <div class="col manuscript-item">
                <div class="manuscript-card">
                    <img src="{{ url_for('static', filename='uploads/' + m['cover_image']) }}" class="card-img-top" alt="Cover">
                    <div class="card-body">
                        <h5 class="card-title manuscript-title">{{ m['title'] }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted" style="color: #999 !important;">{{ m['genre'] }} | {{ m['era'] }}</h6>
                        <p class="card-text">{{ m['description'] }}</p>
                    </div>
                    <a href="/reader/{{ m['id'] }}" class="view-overlay">
                        <div class="btn-view">VIEW</div>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- AI Button -->
    <div class="chat-btn" onclick="window.location.href='/ai'">
        <img src="https://img.icons8.com/ios-filled/50/000000/robot.png" width="30">
    </div>

    <div class="chat-sidebar" id="chatSidebar">
        <div class="chat-header">Gemini Archivist</div>
        <div class="chat-body" id="chatBody"><p>Namaste! Ask me anything about the manuscripts.</p></div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Type here..." onkeypress="handleChat(event)">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Particle Effect
        const bg = document.getElementById('bgEffect');
        for(let i=0; i<20; i++){
            let p = document.createElement('div');
            p.className = 'particle';
            p.style.width = Math.random() * 10 + 'px';
            p.style.height = p.style.width;
            p.style.left = Math.random() * 100 + 'vw';
            p.style.top = Math.random() * 100 + 'vh';
            p.style.animationDuration = (Math.random() * 10 + 10) + 's';
            bg.appendChild(p);
        }

        function filterManuscripts() {
            let input = document.getElementById('searchInput').value.toLowerCase();
            let cards = document.getElementsByClassName('manuscript-item');
            for (let i = 0; i < cards.length; i++) {
                let text = cards[i].innerText.toLowerCase();
                cards[i].style.display = text.includes(input) ? "" : "none";
            }
        }

        function toggleChat() { document.getElementById('chatSidebar').classList.toggle('active'); }

        async function handleChat(e) {
            if (e.key === 'Enter') {
                let input = document.getElementById('chatInput');
                let message = input.value;
                if (!message) return;
                let chatBody = document.getElementById('chatBody');
                chatBody.innerHTML += `<p style="color:#c9a86a"><strong>You:</strong> ${message}</p>`;
                input.value = '';
                const response = await fetch('/chat_api', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({message: message}) });
                const data = await response.json();
                chatBody.innerHTML += `<p><strong>AI:</strong> ${data.response}</p>`;
                chatBody.scrollTop = chatBody.scrollHeight;
            }
        }
    </script>
</body>
</html>
